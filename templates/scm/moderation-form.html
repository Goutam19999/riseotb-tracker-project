
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: url('https://images.unsplash.com/photo-1729575846609-da7ba4369bf0?q=80&w=1932&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
      padding: 40px;
    }

    form {
      background-color: #ffffff;
      border-radius: 8px;
      width: 900px;
      margin: 0 auto;
      padding: 30px 40px;
      box-shadow: 0 0 20px rgba(0,0,0,0.05);
    }

    form label {
      display: block;
      font-weight: 500;
      margin-bottom: 5px;
      color: #333;
    }

    form input[type="text"],
    form select {
      width: 100%;
      padding: 10px 12px;
      margin-bottom: 30px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 15px;
      transition: border 0.3s ease;
    }

    form input[type="text"]:focus,
    form select:focus {
      border-color: #007bff;
      outline: none;
    }

    form input[type="radio"],
    form input[type="checkbox"] {
      width: 18px;
      height: 18px;
      vertical-align: middle;
      cursor: pointer;
      margin-right: 8px;
    }

    #selected_labels_container {
      margin-top: 10px;
      padding: 15px;
      background-color: #f1f1f1;
      border-radius: 6px;
      border: 1px solid #ddd;
    }

    #selected_labels_label {
      font-weight: 600;
      color: #444;
      margin-bottom: 10px;
      display: block;
    }

    #selected_labels_choices div {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    button[type="submit"] {
      background-color: #007bff;
      color: white;
      font-size: 16px;
      padding: 10px 22px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button[type="submit"]:hover {
      background-color: #0056b3;
    }

    .errorlist {
      color: red;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .back-button {
      display: inline-block;
      margin-bottom: 20px;
      background-color: #6c6ca3;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      position: absolute;
      top: 20px;
      left: 40px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }

    .back-button:hover {
      background-color: #4b4b84;
    }
  </style>
</head>
<body>

<button class="back-button" onclick="history.back()">‚Üê Back</button>
<br><br>
<h1 style="text-align: center;">Moderation Form</h1>

{% if form.non_field_errors %}
  <div class="errorlist">
    {% for error in form.non_field_errors %}
      <p>{{ error }}</p>
    {% endfor %}
  </div>
{% endif %}

<form method="post" id="moderation-form" novalidate>
  {% csrf_token %}

  <label for="{{ form.curalate_image_id.id_for_label }}">{{ form.curalate_image_id.label }}</label>
  {{ form.curalate_image_id }}
  {% if form.curalate_image_id.errors %}
    <div class="errorlist">{{ form.curalate_image_id.errors|striptags }}</div>
  {% endif %}

  <label for="{{ form.curalate_post_id.id_for_label }}">{{ form.curalate_post_id.label }}</label>
  {{ form.curalate_post_id }}
  {% if form.curalate_post_id.errors %}
    <div class="errorlist">{{ form.curalate_post_id.errors|striptags }}</div>
  {% endif %}

  <label for="{{ form.agent_action.id_for_label }}">{{ form.agent_action.label }}</label>
  {{ form.agent_action }}
  {% if form.agent_action.errors %}
    <div class="errorlist">{{ form.agent_action.errors|striptags }}</div>
  {% endif %}

  {{ form.start_time }}
  {{ form.end_time }}

  <div id="selected_labels_container" style="display:none;">
    <label id="selected_labels_label" for="id_selected_labels"></label>
    <div id="selected_labels_choices"></div>
  </div>

  <button type="submit">Submit</button>
</form>

<script>
  const APPROVE_LABEL_CHOICES = {{ approve_choices|safe }};
  const REJECT_LABEL_CHOICES = {{reject_choices|safe }};

  const agentActionSelect = document.getElementById('id_agent_action');
  const selectedLabelsContainer = document.getElementById('selected_labels_container');
  const selectedLabelsLabel = document.getElementById('selected_labels_label');
  const selectedLabelsChoices = document.getElementById('selected_labels_choices');

  function pad(num) {
    return num.toString().padStart(2, '0');
  }

  function formatTime(date) {
    return pad(date.getHours()) + ':' + pad(date.getMinutes()) + ':' + pad(date.getSeconds());
  }

  function createChoiceInput(name, value, text, type = 'checkbox') {
    const id = `id_selected_labels_${value.replace(/\W/g, '_')}`;
    const wrapper = document.createElement('div');

    const input = document.createElement('input');
    input.type = type;
    input.name = name;
    input.value = value;
    input.id = id;

    const label = document.createElement('label');
    label.htmlFor = id;
    label.textContent = text;

    wrapper.appendChild(input);
    wrapper.appendChild(label);

    return wrapper;
  }

  function updateSelectedLabels() {
    const value = agentActionSelect.value;
    selectedLabelsChoices.innerHTML = '';

    if (value === 'approved' || value === 'approved-Instagram Admin Rights Required') {
      selectedLabelsContainer.style.display = 'block';
      selectedLabelsLabel.textContent = "4. What label selected for the Post along with 'crm-trg-feed'?";

      APPROVE_LABEL_CHOICES.forEach(function(label) {
        const checkbox = createChoiceInput('selected_labels', label[0], label[1], 'checkbox');
        selectedLabelsChoices.appendChild(checkbox);
      });

    } else if (value === 'rejected') {
      selectedLabelsContainer.style.display = 'block';
      selectedLabelsLabel.textContent = "4. Reason for Rejection";

      REJECT_LABEL_CHOICES.forEach(function(label) {
        const radio = createChoiceInput('selected_labels', label[0], label[1], 'radio');
        selectedLabelsChoices.appendChild(radio);
      });

    } else {
      selectedLabelsContainer.style.display = 'none';
      selectedLabelsLabel.textContent = '';
    }
  }

  document.addEventListener('DOMContentLoaded', function () {
    const startTimeInput = document.getElementById('id_start_time');
    if (startTimeInput) {
      startTimeInput.value = formatTime(new Date());
    }
    updateSelectedLabels();
  });

  agentActionSelect.addEventListener('change', updateSelectedLabels);

  document.getElementById('moderation-form').addEventListener('submit', function (e) {
    const selectedLabelsVisible = selectedLabelsContainer.style.display !== 'none';
    const selectedInputs = selectedLabelsChoices.querySelectorAll('input[name="selected_labels"]:checked');

    const existingError = document.getElementById('label-error');
    if (existingError) existingError.remove();

    if (selectedLabelsVisible && selectedInputs.length === 0) {
      e.preventDefault();

      const errorMsg = document.createElement('div');
      errorMsg.className = 'errorlist';
      errorMsg.id = 'label-error';
      errorMsg.textContent = 'This field is required. Please select a label.';
      selectedLabelsContainer.insertBefore(errorMsg, selectedLabelsChoices);
    } else {
      const endTimeInput = document.getElementById('id_end_time');
      if (endTimeInput) {
        endTimeInput.value = formatTime(new Date());
      }
    }
  });
</script>


